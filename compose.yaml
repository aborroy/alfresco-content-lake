services:
  batch-ingester:
    build:
      context: ./batch-ingester
      dockerfile: Dockerfile
    ports:
      - "9090:9090"
    environment:
      # Alfresco SDK configuration
      CONTENT_SERVICE_URL: http://localhost:8080
      CONTENT_SERVICE_SECURITY_BASICAUTH_USERNAME: admin
      CONTENT_SERVICE_SECURITY_BASICAUTH_PASSWORD: admin
      
      # hxpr
      HXPR_URL: http://localhost:8080
      HXPR_REPOSITORY_ID: default
      HXPR_TARGET_PATH: /alfresco-sync
      HXPR_IDP_TOKEN_URL: http://localhost:5002/idp/connect/token
      HXPR_IDP_CLIENT_ID: nuxeo-client
      HXPR_IDP_CLIENT_SECRET: secret
      HXPR_IDP_USERNAME: testuser
      HXPR_IDP_PASSWORD: password
      
      # Docker Model Runner
      MODEL_RUNNER_URL: http://model-runner.docker.internal/engines/llama.cpp/v1
      EMBEDDING_MODEL: ai/mxbai-embed-large

      # Transformation
      TRANSFORM_WORKERS: 4
      TRANSFORM_QUEUE_CAPACITY: 1000

      # Embedding
      EMBEDDING_CHUNK_SIZE: 1000
      EMBEDDING_CHUNK_OVERLAP: 200

  rag-service:
    build:
      context: ./rag-service
      dockerfile: Dockerfile
    ports:
      - "9091:9091"
    environment:
      # Alfresco SDK configuration
      CONTENT_SERVICE_URL: http://localhost:8080
      CONTENT_SERVICE_SECURITY_BASICAUTH_USERNAME: admin
      CONTENT_SERVICE_SECURITY_BASICAUTH_PASSWORD: admin

      # hxpr
      HXPR_URL: http://localhost:8080
      HXPR_REPOSITORY_ID: default
      HXPR_TARGET_PATH: /alfresco-sync
      HXPR_IDP_TOKEN_URL: http://localhost:5002/idp/connect/token
      HXPR_IDP_CLIENT_ID: nuxeo-client
      HXPR_IDP_CLIENT_SECRET: secret
      HXPR_IDP_USERNAME: testuser
      HXPR_IDP_PASSWORD: password

      # Docker Model Runner
      MODEL_RUNNER_URL: http://model-runner.docker.internal/engines/llama.cpp/v1
      EMBEDDING_MODEL: ai/mxbai-embed-large
      LLM_MODEL: ai/llama3.2
      LLM_TEMPERATURE: 0.3
      LLM_MAX_TOKENS: 1024

      # RAG configuration
      RAG_DEFAULT_TOP_K: 5
      RAG_DEFAULT_MIN_SCORE: 0.5
      RAG_MAX_CONTEXT_LENGTH: 12000